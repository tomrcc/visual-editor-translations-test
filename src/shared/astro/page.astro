---
export interface Props {
  contentBlocks: any[];
  selected_visual_editor_translation: string;
}

const components: Record<string, Function> = {};
const componentImports = import.meta.glob("../../components/**/*.{jsx,astro}", {
  eager: true,
});
Object.entries(componentImports).forEach(([path, obj]) => {
  const parts = path.replace("../../components/", "").split(".")[0].split("/");
  if (parts.length > 1 && parts[parts.length - 1] === parts[parts.length - 2]) {
    parts.pop();
  }
  const bookshopName = parts.join("/");
  components[bookshopName] = (obj as any).default;
});

const { contentBlocks, selected_visual_editor_translation } = Astro.props;
---

<main>
  {
    contentBlocks.map((block, i) => {
      const Component = components[block._bookshop_name];
      const blockWithSVET: object = {
        selected_visual_editor_translation: selected_visual_editor_translation,
        ...block,
      };
      return <Component {...blockWithSVET} key={i} />;
    })
  }
</main>
